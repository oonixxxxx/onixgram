from app import app, db, User, Tweet
from werkzeug.security import generate_password_hash
from datetime import datetime
import random

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–Ω–æ–≥–æ –±–æ—Ç–∞
NEWS_BOT = {
    'username': 'gpt_news',
    'email': 'news@twitterclone.com',
    'password': 'secure_news_password',
    'bio': 'ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –±–æ—Ç | –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç'
}

SAMPLE_NEWS = [
    "üåç –ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –±–æ—Ä—å–±–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–ª–∏–º–∞—Ç–∞: —É—á–µ–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
    "üí° –ü—Ä–æ—Ä—ã–≤ –≤ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö: —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ç–∏–ø –∫—É–±–∏—Ç–∞",
    "üöÄ SpaceX –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–ª–∞ –Ω–æ–≤—É—é –º–∏—Å—Å–∏—é –Ω–∞ –ú–∞—Ä—Å",
    "ü§ñ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –Ω–∞—É—á–∏–ª—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É —Ç–æ—á–Ω–µ–µ –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–æ–≤",
    "üì± –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤ —Å —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–µ–π",
    "üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±—É–¥—É—â–µ–≥–æ: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö",
    "üéÆ –ò–≥—Ä–æ–≤–∞—è –∏–Ω–¥—É—Å—Ç—Ä–∏—è: –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –≥–æ–¥–∞",
    "üíä –ü—Ä–æ—Ä—ã–≤ –≤ –º–µ–¥–∏—Ü–∏–Ω–µ: –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –ª–µ—á–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π",
    "üå± –≠–∫–æ–ª–æ–≥–∏—á–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –±—É–¥—É—â–µ–≥–æ",
    "üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ: –∫–∞–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –º–µ–Ω—è—é—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è"
]

def get_news():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π"""
    news_text = random.choice(SAMPLE_NEWS)
    current_time = datetime.now().strftime('%H:%M')
    return f"{news_text}\n\n–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ {current_time}"

def test_bot():
    with app.app_context():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
        bot = User.query.filter_by(username=NEWS_BOT['username']).first()
        if not bot:
            print("–°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞...")
            bot = User(
                username=NEWS_BOT['username'],
                email=NEWS_BOT['email'],
                password=generate_password_hash(NEWS_BOT['password']),
                bio=NEWS_BOT['bio']
            )
            db.session.add(bot)
            db.session.commit()
        
        # –ü—É–±–ª–∏–∫—É–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        test_tweet = Tweet(
            content=get_news(),
            user_id=bot.id,
            timestamp=datetime.utcnow()
        )
        db.session.add(test_tweet)
        db.session.commit()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–≤–∏—Ç —Å–æ–∑–¥–∞–ª—Å—è
        latest_tweet = Tweet.query.filter_by(user_id=bot.id).order_by(Tweet.timestamp.desc()).first()
        if latest_tweet:
            print(f"–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —Ç–≤–∏—Ç: {latest_tweet.content}")
        else:
            print("–û—à–∏–±–∫–∞: —Ç–≤–∏—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω")

if __name__ == '__main__':
    test_bot() 